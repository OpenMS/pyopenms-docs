

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reading Raw MS data &mdash; pyOpenMS 2.5.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mzML files" href="mzMLFileFormat.html" />
    <link rel="prev" title="Getting Started" href="getting_started.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pyOpenMS
          

          
          </a>

          
            
            
              <div class="version">
                2.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">pyOpenMS Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">First steps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reading Raw MS data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mzml-files-in-memory">mzML files in memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#indexed-mzml-files">indexed mzML files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mzml-files-as-streams">mzML files as streams</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cached-mzml-files">cached mzML files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mzMLFileFormat.html">mzML files</a></li>
<li class="toctree-l1"><a class="reference internal" href="other_file_handling.html">Other MS data formats</a></li>
</ul>
<p class="caption"><span class="caption-text">Mass Spectrometry Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="datastructures.html">MS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="chemistry.html">Chemistry</a></li>
<li class="toctree-l1"><a class="reference internal" href="aasequences.html">Peptides and Proteins</a></li>
<li class="toctree-l1"><a class="reference internal" href="nasequences.html">Oligonucleotides: RNA</a></li>
<li class="toctree-l1"><a class="reference internal" href="theoreticalspectrumgenerator.html">TheoreticalSpectrumGenerator</a></li>
<li class="toctree-l1"><a class="reference internal" href="digestion.html">Digestion</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastructures_id.html">Identification Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="datastructures_quant.html">Quantitative Data</a></li>
</ul>
<p class="caption"><span class="caption-text">Simple Data Manipulation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_manipulation.html">Simple Data Manipulation</a></li>
</ul>
<p class="caption"><span class="caption-text">OpenMS Algorithms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parameter_handling.html">Parameter Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="smoothing.html">Smoothing</a></li>
<li class="toctree-l1"><a class="reference internal" href="mass_decomposition.html">Mass Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="deisotoping.html">Charge and Isotope Deconvolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_detection.html">Feature Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="peptide_search.html">Peptide Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="chromatographic_analysis.html">Chromagraphic Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">R language</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyopenms_in_r.html">pyOpenMS in R</a></li>
</ul>
<p class="caption"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="build_from_source.html">Build from source</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrap_classes.html">Wrapping Workflow and wrapping new Classes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyOpenMS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Reading Raw MS data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/file_handling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="reading-raw-ms-data">
<h1>Reading Raw MS data<a class="headerlink" href="#reading-raw-ms-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mzml-files-in-memory">
<h2>mzML files in memory<a class="headerlink" href="#mzml-files-in-memory" title="Permalink to this headline">¶</a></h2>
<p>As discussed in the last section, the most straight forward way to load mass
spectrometric data is using the <code class="docutils literal notranslate"><span class="pre">MzMLFile</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>
<span class="c1"># from urllib import urlretrieve  # use this code for Python 2.x</span>
<span class="n">urlretrieve</span> <span class="p">(</span><span class="s2">&quot;http://proteowizard.sourceforge.net/example_data/tiny.pwiz.1.1.mzML&quot;</span><span class="p">,</span> <span class="s2">&quot;test.mzML&quot;</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">MSExperiment</span><span class="p">()</span>
<span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;test.mzML&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
<p>which will load the content of the “test.mzML” file into the <code class="docutils literal notranslate"><span class="pre">exp</span></code>
variable of type <code class="docutils literal notranslate"><span class="pre">MSExperiment</span></code>. We can access the raw data and spectra through:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_data</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">getSpectrum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()</span>
<span class="n">chromatogram_data</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()</span>
</pre></div>
</div>
<p>Which will allow us to compute on spectra and chromatogram data. We can
manipulate the spectra in the file for example as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">exp</span><span class="o">.</span><span class="n">getSpectra</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getMSLevel</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">exp</span><span class="o">.</span><span class="n">setSpectra</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
<p>Which will only keep MS2 spectra in the <code class="docutils literal notranslate"><span class="pre">MSExperiment</span></code>. We can then store the modified data structure on disk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;filtered.mzML&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
<p>Putting this together, a small filtering program would look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Script to read mzML data and filter out all MS1 spectra</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">MSExperiment</span><span class="p">()</span>
<span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;test.mzML&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

<span class="n">spec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">exp</span><span class="o">.</span><span class="n">getSpectra</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getMSLevel</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">exp</span><span class="o">.</span><span class="n">setSpectra</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

<span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;filtered.mzML&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="indexed-mzml-files">
<h2>indexed mzML files<a class="headerlink" href="#indexed-mzml-files" title="Permalink to this headline">¶</a></h2>
<p>Since pyOpenMS 2.4, you can open, read and inspect files that use the
indexedMzML standard. This allows users to read MS data without loading all
data into memory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">od_exp</span> <span class="o">=</span> <span class="n">OnDiscMSExperiment</span><span class="p">()</span>
<span class="n">od_exp</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="s2">&quot;test.mzML&quot;</span><span class="p">)</span>
<span class="n">meta_data</span> <span class="o">=</span> <span class="n">od_exp</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
<span class="n">meta_data</span><span class="o">.</span><span class="n">getNrChromatograms</span><span class="p">()</span>
<span class="n">od_exp</span><span class="o">.</span><span class="n">getNrChromatograms</span><span class="p">()</span>

<span class="c1"># data is not present in meta_data experiment</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">meta_data</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># no data!</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">od_exp</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># data is here!</span>

<span class="c1"># meta data is present and identical in both data structures:</span>
<span class="n">meta_data</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNativeID</span><span class="p">()</span> <span class="c1"># fast</span>
<span class="n">od_exp</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNativeID</span><span class="p">()</span> <span class="c1"># slow</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">OnDiscMSExperiment</span></code> allows users to access meta data through
the <code class="docutils literal notranslate"><span class="pre">getMetaData</span></code> function, which allows easy selection and filtering on meta
data attributes (such as MS level, precursor <em>m/z</em>, retention time etc.) in
order to select spectra and chromatograms for analysis.  Only once selection on
the meta data has been performed, will actual data be loaded into memory using
the <code class="docutils literal notranslate"><span class="pre">getChromatogram</span></code> and <code class="docutils literal notranslate"><span class="pre">getSpectrum</span></code> functions.</p>
<p>This approach is memory efficient in cases where computation should only occur
on part of the data or the whole data may not fit into memory.</p>
</div>
<div class="section" id="mzml-files-as-streams">
<h2>mzML files as streams<a class="headerlink" href="#mzml-files-as-streams" title="Permalink to this headline">¶</a></h2>
<p>In some instances it is impossible or inconvenient to load all data from an
mzML file directly into memory. OpenMS offers streaming-based access to mass
spectrometric data which uses a callback object that receives spectra and
chromatograms as they are read from the disk. A simple implementation could look like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MSCallback</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">setExperimentalSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setExpectedSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">consumeChromatogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Read a chromatogram&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">consumeSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot;Read a spectrum&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>which can the be used as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filename</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;test.mzML&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">consumer</span> <span class="o">=</span> <span class="n">MSCallback</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">consumer</span><span class="p">)</span>
<span class="go">Read a spectrum</span>
<span class="go">Read a spectrum</span>
<span class="go">Read a spectrum</span>
<span class="go">Read a spectrum</span>
<span class="go">Read a chromatogram</span>
<span class="go">Read a chromatogram</span>
</pre></div>
</div>
<p>which provides an intuition on how the callback object works: whenever a
spectrum or chromatogram is read from disk, the function <code class="docutils literal notranslate"><span class="pre">consumeSpectrum</span></code> or
<code class="docutils literal notranslate"><span class="pre">consumeChromatogram</span></code> is called and a specific action is performed. We can
use this to implement a simple filtering function for mass spectra:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">FilteringConsumer</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Consumer that forwards all calls the internal consumer (after</span>
<span class="sd">    filtering)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="n">filter_string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_consumer</span> <span class="o">=</span> <span class="n">consumer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_string</span> <span class="o">=</span> <span class="n">filter_string</span>

    <span class="k">def</span> <span class="nf">setExperimentalSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_consumer</span><span class="o">.</span><span class="n">setExperimentalSettings</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setExpectedSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal_consumer</span><span class="o">.</span><span class="n">setExpectedSize</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">consumeChromatogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">getNativeID</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_string</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_consumer</span><span class="o">.</span><span class="n">consumeChromatogram</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">consumeSpectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">getNativeID</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_string</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_internal_consumer</span><span class="o">.</span><span class="n">consumeSpectrum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1">###################################</span>
<span class="n">filter_string</span> <span class="o">=</span> <span class="s2">&quot;DECOY&quot;</span>
<span class="n">inputfile</span> <span class="o">=</span> <span class="s2">&quot;in.mzML&quot;</span>
<span class="n">outputfile</span> <span class="o">=</span> <span class="s2">&quot;out.mzML&quot;</span>
<span class="c1">###################################</span>

<span class="n">consumer</span> <span class="o">=</span> <span class="n">PlainMSDataWritingConsumer</span><span class="p">(</span><span class="n">outputfile</span><span class="p">)</span>
<span class="n">consumer</span> <span class="o">=</span> <span class="n">FilteringConsumer</span><span class="p">(</span><span class="n">consumer</span><span class="p">,</span> <span class="n">filter_string</span><span class="p">)</span>

<span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span> <span class="n">consumer</span><span class="p">)</span>
</pre></div>
</div>
<p>where the spectra and chromatograms are filtered by their native ids. It is
similarly trivial to implement filtering by other attributes. Note how the data
are written to disk using the <code class="docutils literal notranslate"><span class="pre">PlainMSDataWritingConsumer</span></code> which is one of
multiple available consumer classes – this specific class will simply take the
spectrum <code class="docutils literal notranslate"><span class="pre">s</span></code> or chromatogram <code class="docutils literal notranslate"><span class="pre">c</span></code> and write it to disk (the location of the
output file is given by the <code class="docutils literal notranslate"><span class="pre">outfile</span></code> variable).</p>
<p>Note that this approach is memory efficient in cases where computation should
only occur on part of the data or the whole data may not fit into memory.</p>
</div>
<div class="section" id="cached-mzml-files">
<h2>cached mzML files<a class="headerlink" href="#cached-mzml-files" title="Permalink to this headline">¶</a></h2>
<p>In addition, since pyOpenMS 2.4 the user can efficiently cache mzML files to disk which
provides very fast access with minimal overhead in memory. Basically the data
directly mapped into memory when requested. You can use this feature as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># First load data and cache to disk</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">MSExperiment</span><span class="p">()</span>
<span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;test.mzML&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
<span class="n">CachedmzML</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s2">&quot;myCache.mzML&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

<span class="c1"># Now load data</span>
<span class="n">cfile</span> <span class="o">=</span> <span class="n">CachedmzML</span><span class="p">()</span>
<span class="n">CachedmzML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;myCache.mzML&quot;</span><span class="p">,</span> <span class="n">cfile</span><span class="p">)</span>

<span class="n">meta_data</span> <span class="o">=</span> <span class="n">cfile</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
<span class="n">cfile</span><span class="o">.</span><span class="n">getNrChromatograms</span><span class="p">()</span>
<span class="n">cfile</span><span class="o">.</span><span class="n">getNrSpectra</span><span class="p">()</span>

<span class="c1"># data is not present in meta_data experiment</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">meta_data</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># no data!</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">cfile</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># data is here!</span>

<span class="c1"># meta data is present and identical in both data structures:</span>
<span class="n">meta_data</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNativeID</span><span class="p">()</span> <span class="c1"># fast</span>
<span class="n">cfile</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getNativeID</span><span class="p">()</span> <span class="c1"># slow</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">CachedmzML</span></code> allows users to access meta data through
the <code class="docutils literal notranslate"><span class="pre">getMetaData</span></code> function, which allows easy selection and filtering on meta
data attributes (such as MS level, precursor <em>m/z</em>, retention time etc.) in
order to select spectra and chromatograms for analysis.  Only once selection on
the meta data has been performed, will actual data be loaded into memory using
the <code class="docutils literal notranslate"><span class="pre">getChromatogram</span></code> and <code class="docutils literal notranslate"><span class="pre">getSpectrum</span></code> functions.</p>
<p>Note that in the example above all data is loaded into memory first and then
cached to disk. This is not very efficient and we can use the
<code class="docutils literal notranslate"><span class="pre">MSDataCachedConsumer</span></code> to directly cache to disk (without loading any data
into memory):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyopenms</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># First cache to disk</span>
<span class="c1"># Note: writing meta data to myCache2.mzML is required</span>
<span class="n">cacher</span> <span class="o">=</span> <span class="n">MSDataCachedConsumer</span><span class="p">(</span><span class="s2">&quot;myCache2.mzML.cached&quot;</span><span class="p">)</span>
<span class="n">exp</span> <span class="o">=</span> <span class="n">MSExperiment</span><span class="p">()</span>
<span class="n">MzMLFile</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;test.mzML&quot;</span><span class="p">,</span> <span class="n">cacher</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
<span class="n">CachedMzMLHandler</span><span class="p">()</span><span class="o">.</span><span class="n">writeMetadata</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="s2">&quot;myCache2.mzML&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">cacher</span>

<span class="c1"># Now load data</span>
<span class="n">cfile</span> <span class="o">=</span> <span class="n">CachedmzML</span><span class="p">()</span>
<span class="n">CachedmzML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;myCache2.mzML&quot;</span><span class="p">,</span> <span class="n">cfile</span><span class="p">)</span>

<span class="n">meta_data</span> <span class="o">=</span> <span class="n">cfile</span><span class="o">.</span><span class="n">getMetaData</span><span class="p">()</span>
<span class="c1"># data is not present in meta_data experiment</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">meta_data</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># no data!</span>
<span class="nb">sum</span><span class="p">(</span><span class="n">cfile</span><span class="o">.</span><span class="n">getChromatogram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_peaks</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># data is here!</span>
</pre></div>
</div>
<p>This approach is now memory efficient in cases where computation should only occur
on part of the data or the whole data may not fit into memory.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mzMLFileFormat.html" class="btn btn-neutral float-right" title="mzML files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="getting_started.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, OpenMS Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>